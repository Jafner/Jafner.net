version: '3'
services:
  archivebox:
    image: archivebox/archivebox:latest
    container_name: archivebox
    command: server 0.0.0.0:8000
    stdin_open: true
    tty: true
    networks:
      - web
      - archivebox
    environment:
      - USE_COLOR=TRUE
      - SHOW_PROGRESS=TRUE
      - SEARCH_BACKEND_ENGINE=sonic
      - SEARCH_BACKEND_HOST_NAME=sonic
      - SEARCH_BACKEND_PASSWORD=joeyyeoj
    volumes:
      - ./data:/data:z
    depends_on:
      - sonic
    labels:
      - traefik.enabled=true
      - traefik.http.routers.archivebox.rule=Host(`archive.jafner.net`)
      - traefik.http.routers.archivebox.tls=true
      - traefik.http.routers.archivebox.tls.certresolver=lets-encrypt
  sonic:
    image: valeriansaliou/sonic:v1.3.0
    container_name: sonic
    networks:
      - archivebox
    environment:
      - SEARCH_BACKEND_PASSWORD=joeyyeoj
    volumes:
      - ./etc:/etc:z
      - ./data:/var/lib/sonic/store/:z
    labels:
      - traefik.enabled=false
networks:
  web:
    external: true
  archivebox:
