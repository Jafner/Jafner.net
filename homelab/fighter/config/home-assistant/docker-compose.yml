version: '3.9'
services:
  home-assistant:
    image: lscr.io/linuxserver/homeassistant:latest
    container_name: home-assistant_home-assistant
    env_file:
      - home-assistant.env
    networks:
      - web
      - home-assistant
    volumes:
      - $DOCKER_DATA/home-assistant:/config
    labels:
      - traefik.http.routers.home-assistant.rule=Host(`homeassistant.jafner.net`)
      - traefik.http.routers.home-assistant.tls.certresolver=lets-encrypt

  mosquitto:
    image: eclipse-mosquitto:latest
    container_name: home-assistant_mosquitto
    networks:
      - home-assistant
    volumes:
      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
      - ./mosquitto.passwd:/mosquitto/config/mosquitto.passwd
      - $DOCKER_DATA/mosquitto:/mosquitto/data
    ports:
      - 12883:1883
      - 19001:9001

networks:
  web:
    external: true
  home-assistant: