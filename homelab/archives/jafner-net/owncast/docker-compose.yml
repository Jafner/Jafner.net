version: "3"
services:
  owncast:
    image: gabekangas/owncast:latest
    container_name: owncast_owncast
    logging:
      driver: loki
      options:
        loki-url: http://localhost:3100/loki/api/v1/push
        loki-batch-size: "50"
        loki-retries: "1"
        loki-timeout: "2s"
        keep-file: "true"
    deploy:
      resources:
        limits:
          memory: 6G
    networks:
      - web
    restart: "no"
    volumes:
      - $DOCKER_DATA:/app/data
    ports:
      - 1935:1935
    labels:
      - traefik.http.routers.owncast.rule=Host(`owncast.jafner.net`)
      - traefik.http.routers.owncast.tls.certresolver=lets-encrypt
      #- traefik.http.routers.owncast.middlewares=traefik-forward-auth-privileged@file
      - traefik.http.services.owncast.loadbalancer.server.port=8080

networks:
  web:
    external: true
