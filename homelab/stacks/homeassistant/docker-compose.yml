services:
  homeassistant:
    image: lscr.io/linuxserver/homeassistant:latest
    container_name: homeassistant_homeassistant
    environment:
      PUID: "1001"
      PGID: "1001"
      TZ: "America/Los_Angeles"
    networks:
      - web
      - homeassistant
    volumes:
      - $APPDATA/homeassistant:/config
      - /run/dbus:/run/dbus:ro
    labels:
      - traefik.http.routers.homeassistant.rule=Host(`homeassistant.jafner.net`)
      - traefik.http.routers.homeassistant.tls.certresolver=lets-encrypt

  mosquitto:
    image: eclipse-mosquitto:latest
    container_name: homeassistant_mosquitto
    networks:
      - homeassistant
    volumes:
      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
      - /run/secrets/homeassistant/mosquitto:/mosquitto/config/mosquitto.passwd
      - $APPDATA/mosquitto:/mosquitto/data
    ports:
      - 12883:1883
      - 19001:9001

networks:
  web:
    external: true
  homeassistant: