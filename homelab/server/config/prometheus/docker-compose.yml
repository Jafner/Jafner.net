version: '3'
services:
    prometheus:
        image: prom/prometheus:latest
        container_name: monitoring_prometheus
        networks:
            - monitoring
            - web
        ports:
            -   9090:9090
        volumes:
            -   ./prometheus.yml:/etc/prometheus/prometheus.yml
        restart: unless-stopped
        command:
            -   "--config.file=/etc/prometheus/prometheus.yml"
        labels:
            -   traefik.http.routers.prometheus.rule=Host(`prometheus.jafner.net`)
            -   traefik.http.routers.prometheus.tls.certresolver=lets-encrypt

    pihole-jafner-net:
        image: ekofr/pihole-exporter:latest
        container_name: monitoring_prometheus-pihole-jafner-net
        restart: unless-stopped
        networks:
            -   monitoring
        environment:
            -   PIHOLE_HOSTNAME=pihole.jafner.net
            -   PIHOLE_PASSWORD=***REMOVED***
            -   INTERVAL=15s
            -   PORT=9617
        labels:
            - traefik.enable=false

    mc-monitor:
        image: itzg/mc-monitor # https://github.com/itzg/mc-monitor
        container_name: monitoring_mc-monitor
        command: export-for-prometheus
        restart: unless-stopped
        networks:
            - monitoring
            - mc-router
        environment:
            EXPORT_SERVERS: e6-056,vanilla,bmcp,e6,e6-dev
        labels:
            - traefik.enable=false

    plex-exporter:
        image: granra/plex_exporter
        container_name: monitoring_plex-exporter
        restart: unless-stopped
        networks:
            - monitoring
        command: 
            - "--plex-server=https://plex.jafner.net"
            - "--token=***REMOVED***"
            - "--auto-discover"
        labels:
            - traefik.enable=false
        

networks:
    monitoring:
        external: true
    web:
        external: true
    mc-router:
        external: true
