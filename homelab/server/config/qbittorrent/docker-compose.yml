version: "3"
services:
  qbittorrent:
    image: linuxserver/qbittorrent
    container_name: qbittorrent
    networks:
      - web
    restart: "no"
    volumes:
      - $DOCKER_DATA:/config
      - $TORRENT_DATA:/torrenting
    env_file:
      - .env
    ports:
      - 50000:50000
    labels:
      - traefik.http.routers.qbt.rule=Host(`qbt.jafner.net`)
      - traefik.http.routers.qbt.tls.certresolver=lets-encrypt
      - traefik.http.routers.qbt.middlewares=authentik@file
      - traefik.http.routers.qbt.priority=10
      - traefik.http.service.qbt.loadbalancer.server.port=8080
      - traefik.http.routers.qbt-auth.rule=Host(`qbt.jafner.net`) && PathPrefix(`/outpost.goauthentik.io/`)
      - traefik.http.routers.qbt-auth.priority=15
      - traefik.http.routers.qbt-auth.services=http://authentik-server:9000/outpost.goauthentik.io

networks:
  web:
    external: true