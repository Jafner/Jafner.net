version: '3'
services:
  pihole:
    image: pihole/pihole
    container_name: pihole_pihole
    logging:
      driver: loki
      options:
        loki-url: http://localhost:3100/loki/api/v1/push
        loki-batch-size: "50"
        loki-retries: "1"
        loki-timeout: "2s"
    user: "1000:1000"
    restart: "no"
    environment:
      PUID: ${PUID}
      PGID: ${PGID}
    volumes:
      - ${DOCKER_DATA}/pihole:/etc/pihole
      - ${DOCKER_DATA}/dnsmasq:/etc/dnsmasq.d
    labels:
      - traefik.http.routers.pihole.rule=Host(`pihole.jafner.net`)
      - traefik.http.routers.pihole.tls.certresolver=lets-encrypt
      - traefik.http.routers.pihole.middlewares=lan-only@file
      - traefik.http.services.pihole.loadbalancer.server.port=80
    networks:
      - web
    ports:
      - "53:53/tcp"
      - "53:53/udp"
networks:
  web:
    external: true