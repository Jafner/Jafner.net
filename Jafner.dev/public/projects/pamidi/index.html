<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="My first project posted publicly. Initially I didn&amp;rsquo;t expect to post it, but I didn&amp;rsquo;t see any other solutions to the problem I was having, so I figured my solution could inspire someone else to do it better.
Problem: Physical Volume Knobs for Applications While using Windows, I installed an application called MIDI Mixer to map the physical volume knobs of my Behringer X-Touch Mini (and the accompanying mute and media control buttons) to individual applications on my PC." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://jafner.dev/projects/pamidi/" />


    <title>
        
            Pamidi - Control PulseAudio with a MIDI device :: Jafner.dev  â€” Hello Friend NG Theme
        
    </title>





<link rel="stylesheet" href="/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css" integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE=">


    
        <link rel="stylesheet" type="text/css" href="/css/toc-no-underline.css">
    


    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Pamidi - Control PulseAudio with a MIDI device">
<meta itemprop="description" content="My first project posted publicly. Initially I didn&rsquo;t expect to post it, but I didn&rsquo;t see any other solutions to the problem I was having, so I figured my solution could inspire someone else to do it better.
Problem: Physical Volume Knobs for Applications While using Windows, I installed an application called MIDI Mixer to map the physical volume knobs of my Behringer X-Touch Mini (and the accompanying mute and media control buttons) to individual applications on my PC."><meta itemprop="datePublished" content="2024-05-28T17:58:19-07:00" />
<meta itemprop="dateModified" content="2024-05-28T17:58:19-07:00" />
<meta itemprop="wordCount" content="1958"><meta itemprop="image" content="https://jafner.dev" />
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://jafner.dev" /><meta name="twitter:title" content="Pamidi - Control PulseAudio with a MIDI device"/>
<meta name="twitter:description" content="My first project posted publicly. Initially I didn&rsquo;t expect to post it, but I didn&rsquo;t see any other solutions to the problem I was having, so I figured my solution could inspire someone else to do it better.
Problem: Physical Volume Knobs for Applications While using Windows, I installed an application called MIDI Mixer to map the physical volume knobs of my Behringer X-Touch Mini (and the accompanying mute and media control buttons) to individual applications on my PC."/>



    <meta property="og:title" content="Pamidi - Control PulseAudio with a MIDI device" />
<meta property="og:description" content="My first project posted publicly. Initially I didn&rsquo;t expect to post it, but I didn&rsquo;t see any other solutions to the problem I was having, so I figured my solution could inspire someone else to do it better.
Problem: Physical Volume Knobs for Applications While using Windows, I installed an application called MIDI Mixer to map the physical volume knobs of my Behringer X-Touch Mini (and the accompanying mute and media control buttons) to individual applications on my PC." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jafner.dev/projects/pamidi/" /><meta property="og:image" content="https://jafner.dev" /><meta property="article:section" content="projects" />
<meta property="article:published_time" content="2024-05-28T17:58:19-07:00" />
<meta property="article:modified_time" content="2024-05-28T17:58:19-07:00" />







    <meta property="article:published_time" content="2024-05-28 17:58:19 -0700 PDT" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                $ ~/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">About</a></li><li><a href="/experience">Experience</a></li><li><a href="/articles">Articles</a></li><li><a href="/projects">Projects</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://jafner.dev/projects/pamidi/">Pamidi - Control PulseAudio with a MIDI device</a></h2>

            
            
            

            <div class="post-content">
                
    <img src="../pamidi.jpg"  class="left"  />


<p>My first project posted publicly. Initially I didn&rsquo;t expect to post it, but I didn&rsquo;t see any other solutions to the problem I was having, so I figured my solution could inspire someone else to do it better.</p>
<h1 id="problem-physical-volume-knobs-for-applications">Problem: Physical Volume Knobs for Applications</h1>
<p>While using Windows, I installed an application called <a href="https://www.midi-mixer.com/">MIDI Mixer</a> to map the physical volume knobs of my <a href="https://www.behringer.com/product.html?modelCode=0808-AAF">Behringer X-Touch Mini</a> (and the accompanying mute and media control buttons) to individual applications on my PC. The most common use-case for me was turning my Spotify music up or down without alt-tabbing from my Overwatch game. My microphone was also mapped into the software.</p>
<p>It&rsquo;s just nice to have a physical interface for these things. But when I tried switching to Pop!_OS a couple years ago, I first <a href="https://www.reddit.com/r/linuxaudio/comments/owqi6j/linux_equivalent_to_midi_mixer_functionality/">inquired at /r/linuxaudio</a> about replicating that functionality on Linux. While I was able to find <a href="https://github.com/solarnz/pamidicontrol">a similar project</a>, nothing really scratched the itch, so I dug in to build my own.</p>
<h1 id="solution-pulseaudio-and-xdotool-in-a-bash-script">Solution: PulseAudio and Xdotool in a Bash Script</h1>
<p>I built <a href="https://github.com/Jafner/pamidi"><code>pamidi</code></a>. We&rsquo;ll break it down here, with the benefit of retrospect.</p>
<h2 id="dependencies">Dependencies</h2>
<p>Two utilities are critical to the function of the script: <a href="https://github.com/jordansissel/xdotool"><code>xdotool</code></a> and <a href="https://man.archlinux.org/man/pacmd.1"><code>pacmd</code></a>. Additionally, we presume you&rsquo;re running SystemD with PulseAudio.</p>
<ul>
<li><code>xdotool</code> is used to get the current focused window. This lets us drastically simplify the UX of mapping the volume knobs to specific applications.</li>
<li><code>pacmd</code> is used to change volume and toggle mute for PulseAudio streams.</li>
</ul>
<h2 id="code-breakdown">Code Breakdown</h2>
<p>Let&rsquo;s take a look at <a href="https://github.com/Jafner/pamidi/blob/main/pamidi.sh">the code</a>. The source is annotated with comments, but we&rsquo;ll just look at the code here.</p>
<h3 id="initialize-the-service">Initialize the Service</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>initialize<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Initializing&#34;</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Checking for xdotool&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> ! hash xdotool &amp;&gt; /dev/null; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>		echo <span style="color:#e6db74">&#34;xdotool could not be found, exiting&#34;</span>
</span></span><span style="display:flex;"><span>		exit <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>		echo <span style="color:#e6db74">&#34;xdotool found&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Waiting for pulseaudio service to start...&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> <span style="color:#f92672">[[</span> <span style="color:#66d9ef">$(</span>systemctl --machine<span style="color:#f92672">=</span>joey@.host --user is-active --quiet pulseaudio<span style="color:#66d9ef">)</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>		echo <span style="color:#e6db74">&#34;Pulseaudio service not started, waiting...&#34;</span>
</span></span><span style="display:flex;"><span>		sleep <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Waiting for X-TOUCH MINI to be connected...&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> <span style="color:#f92672">[[</span> ! <span style="color:#66d9ef">$(</span>lsusb | grep <span style="color:#e6db74">&#34;X-TOUCH MINI&#34;</span><span style="color:#66d9ef">)</span> <span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>		echo <span style="color:#e6db74">&#34;X-TOUCH MINI not connected. Waiting...&#34;</span>
</span></span><span style="display:flex;"><span>		sleep <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">done</span> 
</span></span><span style="display:flex;"><span>	col_1_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	col_2_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	col_3_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	col_4_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	col_5_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	col_6_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	col_7_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	col_8_app_pid<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>	assign_profile_1
</span></span><span style="display:flex;"><span>	print_col_app_ids
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Initialized pamidi&#34;</span>
</span></span><span style="display:flex;"><span>	notify-send <span style="color:#e6db74">&#34;Initialized pamidi&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ol>
<li>First we check to ensure <code>xdotool</code> is installed. <code>hash</code> is a weird choice for checking the presence of a command. Would probably use <code>which</code> today.</li>
<li>Next we wait until we see that the PulseAudio SystemD unit&rsquo;s status is &ldquo;active&rdquo;. But, uh&hellip; I&rsquo;m not sure why I needed that <code>--machine=joey@.host</code> flag.</li>
<li>We wait until <code>lsusb</code> reports the <code>X-TOUCH MINI</code> as connected.</li>
<li>We set up our 8 variables for storing application PIDs.</li>
<li>We invoke a yet-to-be-implemented function <code>assign_profile_1</code>. It does nothing.</li>
<li>We print the PIDs bound to each knob to the console. And then we send an OS notification that the service is initialized.</li>
</ol>
<p>Cool. Now how does it actually work?</p>
<h3 id="change-volume-mackie-vs-standard">Change Volume: Mackie vs. Standard</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>change_volume_mackie<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span> $2 &gt;<span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">))</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>		vol_change<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-</span><span style="color:#66d9ef">$(</span>expr $2 - 64<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>		vol_change<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;+</span>$2<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	app_pid<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	all_sink_inputs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pacmd list-sink-inputs<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	all_sink_inputs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>paste <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		&lt;<span style="color:#f92672">(</span>printf <span style="color:#e6db74">&#39;%s&#39;</span> <span style="color:#e6db74">&#34;</span>$all_sink_inputs<span style="color:#e6db74">&#34;</span> | grep <span style="color:#e6db74">&#39;application.process.id&#39;</span> | cut -d<span style="color:#e6db74">&#39;&#34;&#39;</span> -f 2<span style="color:#66d9ef">)</span><span style="color:#e6db74"> \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&lt;(printf &#39;%s&#39; &#34;</span>$all_sink_inputs<span style="color:#e6db74">&#34; | grep &#39;index: &#39; | rev | cut -d&#39; &#39; -f 1 | rev))&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;</span>$all_sink_inputs<span style="color:#e6db74">&#34;</span> | <span style="color:#66d9ef">while</span> read line ; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>		pid<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$line<span style="color:#e6db74">&#34;</span> | cut -f1<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$pid<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>			stream_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$line<span style="color:#e6db74">&#34;</span> | cut -f2<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>			pactl set-sink-input-volume $stream_id $vol_change% 2&gt; /dev/null
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ol>
<li>We take two positional arguments for this function: application PID, and volume delta.
<ul>
<li>The use of volume delta is the primary differentiator between Mackie mode and standard mode. In Mackie mode, turning the knob returns a <em>change</em> in volume. Values from 0-63 represent <code>-63</code> through <code>-1</code> and values from 64-127 represent <code>+0</code> through <code>+63</code>. We use this to set a <code>volume_change</code> variable.</li>
</ul>
</li>
<li>In order to change volume, we need the sink ID matching the PID for the application we&rsquo;ve bound to a particular knob. We do this in a very roundabout way.
<ol>
<li>We get a list of all PulseAudio sink-inputs (playback streams) with their detailed properties. We need the index (sink ID) and application process ID (our PID).</li>
<li>We do some pipe gymnastics to convert that to an array of tuples in the form <code>&lt;sink-id&gt; &lt;application-pid&gt;</code>. Then we iterate over that list to match the provided application PID.</li>
</ol>
</li>
<li>Lastly, we use <code>pactl set-sink-input-volume</code> to change the volume.
<ul>
<li><code>$stream_id</code> determines which sink-input is affected. Like <code>4</code>.</li>
<li><code>$vol_change</code> is a string of a signed integer in <code>|0-63|</code>. Like <code>-12</code> or <code>+62</code></li>
</ul>
</li>
</ol>
<p>Note: In Standard mode, we use the same <code>pactl</code> command, but the volume argument is prepended with a sign to increment/decrement the volume, rather than set it.</p>
<h3 id="toggle-mute-mute-on-and-mute-off">Toggle Mute, Mute On, and Mute Off</h3>
<p>Instead of posting the full functions, which are highly repetitive, we&rsquo;ll just look at how they differ from each other.</p>
<p>We follow the same process as in change volume to get the stream ID from the PID.</p>
<ul>
<li>Toggle mute: <code>pactl set-sink-input-mute $stream_id toggle</code></li>
<li>Mute on: <code>pactl set-sink-input-mute $stream_id on</code></li>
<li>Mute off: <code>pactl set-sink-input-mute $stream_id off</code></li>
</ul>
<h3 id="get-stream-index-from-pid">Get Stream Index from PID</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>get_stream_index_from_pid<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	all_sink_inputs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pacmd list-sink-inputs<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	all_sink_inputs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>paste <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		&lt;<span style="color:#f92672">(</span>printf <span style="color:#e6db74">&#39;%s&#39;</span> <span style="color:#e6db74">&#34;</span>$all_sink_inputs<span style="color:#e6db74">&#34;</span> | grep <span style="color:#e6db74">&#39;application.process.id&#39;</span> | cut -d<span style="color:#e6db74">&#39;&#34;&#39;</span> -f 2<span style="color:#66d9ef">)</span><span style="color:#e6db74"> \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&lt;(printf &#39;%s&#39; &#34;</span>$all_sink_inputs<span style="color:#e6db74">&#34; | grep &#39;index: &#39; | rev | cut -d&#39; &#39; -f 1 | rev))&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	stream_ids<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;</span>$all_sink_inputs<span style="color:#e6db74">&#34;</span> | <span style="color:#66d9ef">while</span> read line ; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>		pid<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$line<span style="color:#e6db74">&#34;</span> | cut -f1<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$pid<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>			echo <span style="color:#e6db74">&#34;</span>$line<span style="color:#e6db74">&#34;</span> | cut -f2
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>This function does all the gymnastics we repeat in every other function. We just don&rsquo;t use this function anywhere in the code.</p>
<h3 id="get-binary-from-pid">Get Binary from PID</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>get_binary_from_pid<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	output<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>paste -d<span style="color:#e6db74">&#34;\t&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		&lt;<span style="color:#f92672">(</span>printf <span style="color:#e6db74">&#39;%s&#39;</span> <span style="color:#e6db74">&#34;</span>$output<span style="color:#e6db74">&#34;</span> | grep <span style="color:#e6db74">&#39;application.process.id&#39;</span> | cut -d<span style="color:#e6db74">&#39;&#34;&#39;</span> -f 2<span style="color:#66d9ef">)</span><span style="color:#e6db74"> \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&lt;(printf &#39;%s&#39; &#34;</span>$output<span style="color:#e6db74">&#34; | grep &#39;application.process.binary&#39; | cut -d&#39;&#34;</span><span style="color:#960050;background-color:#1e0010">&#39;</span> -f 2<span style="color:#f92672">))</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	echo &#34;</span>$output<span style="color:#e6db74">&#34; | while read line ; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		pid=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$line<span style="color:#e6db74">&#34;</span> | cut -f1<span style="color:#66d9ef">)</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		if [[ &#34;</span>$pid<span style="color:#e6db74">&#34; == &#34;</span>$1<span style="color:#e6db74">&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			echo &#34;</span>$line<span style="color:#e6db74">&#34; | cut -f2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span></code></pre></div><p>This function is not used anywhere. It requires that <code>$output</code> contain the raw response from <code>pactl list-sink-inputs</code>. It creates an array of tuples in the form <code>&lt;pid&gt; &lt;application binary&gt;</code>, and then prints the name of the application binary matching the PID passed to the function as the first positional argument.</p>
<h3 id="bind-application">Bind Application</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>bind_application<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	window_pid<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>xdotool getactivewindow getwindowpid<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	window_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>xdotool getactivewindow getwindowname<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	col_id<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$col_id<span style="color:#e6db74">&#34;</span> in
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#f92672">)</span> col_1_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#f92672">)</span> col_2_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;3&#34;</span> <span style="color:#f92672">)</span> col_3_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;4&#34;</span> <span style="color:#f92672">)</span> col_4_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;5&#34;</span> <span style="color:#f92672">)</span> col_5_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;6&#34;</span> <span style="color:#f92672">)</span> col_6_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;7&#34;</span> <span style="color:#f92672">)</span> col_7_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;8&#34;</span> <span style="color:#f92672">)</span> col_8_app_pid<span style="color:#f92672">=</span>$window_pid <span style="color:#f92672">&amp;&amp;</span> notify-send <span style="color:#e6db74">&#34;Set knob </span>$col_id<span style="color:#e6db74"> to </span>$window_name<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">esac</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>This function is called when we press down on one of the knobs. It binds the currently focused application to that knob. Very nice UX, and reletively simply implemented. It takes the index of the knob pressed as its one positional argument.</p>
<ol>
<li>Use <code>xdotool</code> to get the pid and name of the currently active window.</li>
<li>Assign the window PID to that knob, and send an OS notification to let the user know what happened.</li>
</ol>
<h3 id="main-mackie-and-standard">Main: Mackie and Standard</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>main_mackie<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	aseqdump -p <span style="color:#e6db74">&#34;X-TOUCH MINI&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#66d9ef">while</span> IFS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; ,&#34;</span> read src ev1 ev2 ch label1 data1 label2 data2 rest; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$ev1<span style="color:#e6db74"> </span>$ev2<span style="color:#e6db74"> </span>$data1<span style="color:#e6db74"> </span>$data2<span style="color:#e6db74">&#34;</span> in 
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 1</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 32&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">1</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 89&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_1_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 87&#34;</span>* <span style="color:#f92672">)</span> print_col_app_ids ;; <span style="color:#75715e"># bottom button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 16&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_1_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 2</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 33&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">2</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 90&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_2_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 88&#34;</span>* <span style="color:#f92672">)</span> ;; <span style="color:#75715e"># bottom button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 17&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_2_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 3</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 34&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">3</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 40&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_3_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 91&#34;</span>* <span style="color:#f92672">)</span> media_prev ;;
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 18&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_3_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 4</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 35&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">4</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 41&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_4_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 92&#34;</span>* <span style="color:#f92672">)</span> media_next ;;
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 19&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_4_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 5</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 36&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">5</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 42&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_5_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 86&#34;</span>* <span style="color:#f92672">)</span> ;;
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 20&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_5_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 6</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 37&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">6</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 43&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_6_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 93&#34;</span>* <span style="color:#f92672">)</span> media_stop ;;
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 21&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_6_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 7</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 38&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">7</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 44&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_7_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 94&#34;</span>* <span style="color:#f92672">)</span> media_play_pause ;;
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 22&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_7_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># column 8</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 39&#34;</span>* <span style="color:#f92672">)</span> bind_application <span style="color:#ae81ff">8</span> ;; <span style="color:#75715e"># knob press</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#e6db74">&#34;Note on 45&#34;</span>* <span style="color:#f92672">)</span> toggle_mute $col_8_app_pid ;; <span style="color:#75715e"># top button</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 95&#34;</span>* <span style="color:#f92672">)</span> ;;
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Control change 23&#34;</span>* <span style="color:#f92672">)</span> change_volume $col_8_app_pid $data2 ;; <span style="color:#75715e"># knob turn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># layer a and b buttons</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 84&#34;</span>* <span style="color:#f92672">)</span> assign_profile_1 ;;
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;Note on 85&#34;</span>* <span style="color:#f92672">)</span> assign_profile_2 ;;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">esac</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>This one took a lot of trial and error, and this function is where we would need to implement profiles for different devices.</p>
<ol>
<li>We use <code>aseqdump</code> to attach to the ALSA output stream of the &ldquo;X-TOUCH MINI&rdquo; device (<code>-p &quot;X-TOUCH-MINI</code>).</li>
<li>We read each line in a while loop, and set variables according to the format used by the X-Touch Mini in <code>aseqdump</code>.
<ul>
<li>The sequence <code>$ev1 $ev2 $data1</code> is used to determine which physical interaction was used. Its values look like &ldquo;Note on 36&rdquo; or &ldquo;Control change 18&rdquo;, which represent Knob 5 Press and Knob 3 Turn, respectively.</li>
<li>For knob turn interactions, we pass the <code>$data2</code> value to the change_volume function, otherwise it is discarded.</li>
</ul>
</li>
</ol>
<p>Note: The difference between Mackie and standard here is the mapping between <code>$data1</code> and the physical interaction. E.g. Knob 5 Press in Mackie mode sends &ldquo;Note on 36&rdquo;, and in standard mode it sends &ldquo;Control change 13 127&rdquo;.</p>
<h2 id="future-work">Future Work</h2>
<p>This script was amateurish, and today I don&rsquo;t need the functionality it provides. It&rsquo;s unlikely I will continue to work on it, but as an exercise, there are a few layers of improvements I would make:</p>
<ol>
<li>Remove <code>--machine=joey@.host</code> from the PulseAudio service up check.</li>
<li>Improve the tragic state of optimization for the change volume functions. We <em>do not</em> need to get the entire list of running audio sinks every time we increment or decrement the volume.</li>
<li>Eliminate the repetitiveness of the change volume and mute functions.</li>
<li>Map interactions to ALSA sequence entries more programmatically (e.g. <code>&quot;Note on&quot;) bind_application $(($data1 - 31)) ;;</code>) This can apply to both Mackie and standard mode.</li>
<li>Modularize functions to make it more portable between input devices.</li>
<li>Rewrite in a proper programming language. Python, or Go, or Rust.</li>
</ol>
<h1 id="conclusion">Conclusion</h1>
<p>This was a fun project. I learned a bit about MIDI and ALSA, a bit about Bash and Systemd, and I built something useful.</p>
<p>It was <a href="https://www.reddit.com/r/linuxaudio/comments/qf59fx/a_little_bash_script_to_control_application/">received kindly</a>, despite its vast room for improvement. And some folks are <a href="https://www.reddit.com/r/linuxaudio/comments/1cr9w68/linux_equivalent_to_pcpanel_or_midi_mixer/">still encountering</a> this need, so maybe it&rsquo;s worth revisiting.</p>
<p>Today, I use a <a href="https://www.tc-helicon.com/product.html?modelCode=0803-AAB">GoXLR Mini</a> with <a href="https://github.com/GoXLR-on-Linux/goxlr-utility/">GoXLR-on-Linux/GoXLR-utility</a> to get much of the functionality I was wanting. It&rsquo;s missing some things (like dynamically rebinding faders to applications), but has some nice features pamidi could never replicate, such as microphone audio processing.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            <span><a href="https://jafner.dev"></a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://jafner.dev/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span><span>Theme made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.205d491810c28f95aa953fae884e1c27abe13fdf93ec63b882d0036b248d4a6282eb2d134e4e7225c6ad6e86db87b08488a361ca4a7383d01fcff43f3d57b9c3.js" integrity="sha512-IF1JGBDCj5WqlT&#43;uiE4cJ6vhP9&#43;T7GO4gtADaySNSmKC6y0TTk5yJcatbobbh7CEiKNhykpzg9Afz/Q/PVe5ww=="></script>




    </body>
</html>
